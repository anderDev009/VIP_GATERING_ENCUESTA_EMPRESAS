@model VIP_GATERING.Domain.Entities.Empresa
@{
    ViewData["Title"] = "Editar Empresa";
    var horarios = ViewBag.Horarios as IEnumerable<VIP_GATERING.Domain.Entities.Horario> ?? Array.Empty<VIP_GATERING.Domain.Entities.Horario>();
    var selHorarios = ViewBag.EmpresaSelHorarios as List<int> ?? new List<int>();
    var horarioSlots = ViewBag.EmpresaHorarioSlots as Dictionary<int, string> ?? new();
}
<h1 class="text-2xl font-semibold mb-4 max-w-lg mx-auto">Editar Empresa</h1>

<form asp-action="Edit" method="post" class="space-y-4 card max-w-lg mx-auto">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="Id" />
    <div>
        <label class="block text-sm">Nombre</label>
        <input asp-for="Nombre" class="w-full border rounded p-2" />
    </div>
    <div>
        <label class="block text-sm">RNC</label>
        <input asp-for="Rnc" class="w-full border rounded p-2" />
    </div>
    <div>
        <label class="block text-sm">Persona de contacto</label>
        <input asp-for="ContactoNombre" class="w-full border rounded p-2" />
        <span asp-validation-for="ContactoNombre" class="text-rose-600 text-xs"></span>
    </div>
    <div>
        <label class="block text-sm">Teléfono de contacto</label>
        <input asp-for="ContactoTelefono" class="w-full border rounded p-2" />
        <span asp-validation-for="ContactoTelefono" class="text-rose-600 text-xs"></span>
    </div>
    <div>
        <label class="block text-sm">Dirección</label>
        <textarea asp-for="Direccion" rows="2" class="w-full border rounded p-2"></textarea>
        <span asp-validation-for="Direccion" class="text-rose-600 text-xs"></span>
    </div>
    <div class="grid md:grid-cols-2 gap-4">
        <div>
            <label class="block text-sm">Subsidio activo</label>
            <select asp-for="SubsidiaEmpleados" class="w-full border rounded p-2">
                <option value="true">Si, la empresa subsidia</option>
                <option value="false">No subsidia</option>
            </select>
        </div>
        <div>
            <label class="block text-sm">Tipo de subsidio</label>
            <select asp-for="SubsidioTipo" class="w-full border rounded p-2">
                <option value="0">Porcentaje</option>
                <option value="1">Monto fijo</option>
            </select>
        </div>
    </div>
    <div>
        <label class="block text-sm">Valor del subsidio</label>
        <input asp-for="SubsidioValor" type="number" min="0" step="0.01" class="w-full border rounded p-2" />
        <p class="text-xs text-slate-500 mt-1">Por defecto 75%. Si el tipo es monto fijo, se resta directamente.</p>
    </div>
    <div class="space-y-2 border rounded p-3">
        <div class="flex items-center justify-between">
            <label class="block text-sm font-semibold">Horarios por empresa</label>
            <span class="text-xs text-slate-500">Aplica estos horarios a todas las filiales de la empresa.</span>
        </div>
        <div class="grid gap-3">
            @foreach (var h in horarios)
            {
                var slots = horarioSlots.TryGetValue(h.Id, out var value) ? value : string.Empty;
                <div class="flex flex-wrap items-center gap-3">
                    <label class="flex items-center gap-2 min-w-[140px]">
                        <input type="checkbox" name="empresa_horarios" value="@h.Id" @(selHorarios.Contains(h.Id) ? "checked" : "") />
                        <span>@h.Nombre</span>
                    </label>
                    <div class="flex-1 min-w-[220px]">
                        <label class="block text-xs text-slate-500">Horas permitidas (ej: 12:00, 12:30, 13:00)</label>
                        <input type="text" name="empresa_horario_slots_@h.Id" value="@slots" class="w-full border rounded p-2" />
                    </div>
                </div>
            }
        </div>
    </div>
    <div class="flex gap-2">
        <button class="btn-primary">Guardar</button>
        <a asp-action="Index" class="btn-outline">Cancelar</a>
    </div>
</form>

