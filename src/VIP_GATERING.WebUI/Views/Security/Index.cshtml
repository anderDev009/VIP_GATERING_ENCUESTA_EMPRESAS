@model IEnumerable<VIP_GATERING.WebUI.Controllers.SecurityController.UserVM>
@{
    ViewData["Title"] = "Seguridad";
    var allRoles = (IEnumerable<VIP_GATERING.Infrastructure.Identity.ApplicationRole>)ViewBag.Roles;
}
<div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-semibold">Usuarios y roles</h1>
</div>

<div class="overflow-x-auto">
<table class="min-w-full bg-white border rounded">
    <thead class="bg-slate-100">
    <tr>
        <th class="text-left p-2">Email</th>
        <th class="text-left p-2">Roles</th>
        <th class="p-2">Acciones</th>
    </tr>
    </thead>
    <tbody>
    @foreach (var u in Model)
    {
        <tr class="border-t">
            <td class="p-2">@u.Email</td>
            <td class="p-2">@string.Join(", ", u.Roles)</td>
            <td class="p-2">
                <div class="flex gap-2">
                    @foreach (var r in allRoles)
                    {
                        if (!u.Roles.Contains(r.Name!))
                        {
                            <form asp-action="AssignRole" method="post">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="userId" value="@u.Id" />
                                <input type="hidden" name="role" value="@r.Name" />
                                <button class="btn-outline">Asignar @r.Name</button>
                            </form>
                        }
                        else
                        {
                            <form asp-action="RemoveRole" method="post">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="userId" value="@u.Id" />
                                <input type="hidden" name="role" value="@r.Name" />
                                <button class="btn-outline text-red-600">Quitar @r.Name</button>
                            </form>
                        }
                    }
                </div>
            </td>
        </tr>
    }
    </tbody>
</table>
</div>
