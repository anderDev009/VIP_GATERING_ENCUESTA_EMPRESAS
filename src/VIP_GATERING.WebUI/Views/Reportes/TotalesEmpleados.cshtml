@model VIP_GATERING.WebUI.Models.Reportes.TotalesEmpleadosVM
@{
    ViewData["Title"] = "Totales por empleado";
    var isAdmin = User.IsInRole("Admin");
}

<h1 class="text-xl font-semibold mb-4">Totales por empleado (@Model.Inicio:yyyy-MM-dd a @Model.Fin:yyyy-MM-dd)</h1>

<form method="get" class="mb-4 flex flex-wrap gap-3 items-end">
    @if (User.IsInRole("Admin"))
    {
        <div>
            <label class="block text-sm mb-1">Empresa</label>
            <select name="empresaId" class="input">
                <option value="">Todas</option>
                @foreach (var e in Model.Empresas)
                {
                    <option value="@e.Id" selected="@(Model.EmpresaId == e.Id ? "selected" : null)">@e.Nombre</option>
                }
            </select>
        </div>
    }
    <div>
        <label class="block text-sm mb-1">Dependiente</label>
        <select name="sucursalId" class="input">
            <option value="">Todas</option>
            @foreach (var s in Model.Sucursales)
            {
                <option value="@s.Id" selected="@(Model.SucursalId == s.Id ? "selected" : null)">@s.Nombre</option>
            }
        </select>
    </div>
    <button type="submit" class="btn">Filtrar</button>
    <a class="btn-outline" asp-action="TotalesEmpleados">Limpiar</a>
    <div class="ml-auto text-right space-y-1">
        <div class="text-sm text-slate-600">Total costo</div>
        <div class="text-lg font-semibold">@Model.TotalCosto.ToString("C")</div>
        <div class="text-xs text-slate-500">@Model.TotalSelecciones selecciones</div>
        @if (isAdmin)
        {
            <div class="text-sm text-slate-600 pt-1 border-t border-slate-200">Consumo empleados: <span class="font-semibold">@Model.TotalPrecio.ToString("C")</span></div>
            <div class="text-sm text-slate-600">Beneficio: <span class="font-semibold">@Model.TotalBeneficio.ToString("C")</span></div>
        }
    </div>
    <a class="btn-outline" asp-action="TotalesEmpleadosPdf" asp-route-empresaId="@Model.EmpresaId" asp-route-sucursalId="@Model.SucursalId">Exportar PDF</a>
    <style>
        .input{border:1px solid #cbd5e1;padding:.375rem .5rem;border-radius:.375rem;}
        .btn{background:#4f46e5;color:white;padding:.5rem .75rem;border-radius:.375rem}
        .btn-outline{border:1px solid #4f46e5;color:#4f46e5;padding:.5rem .75rem;border-radius:.375rem}
        table{width:100%;border-collapse:collapse}
        th,td{border-bottom:1px solid #e2e8f0;padding:.5rem;text-align:left}
    </style>
    <script>history.scrollRestoration = 'manual';</script>
</form>

<table>
    <thead>
    <tr>
        <th>Empleado</th>
        <th class="text-right">Selecciones</th>
        <th class="text-right">Costo empresa</th>
        @if (isAdmin)
        {
            <th class="text-right">Consumo</th>
            <th class="text-right">Beneficio</th>
        }
    </tr>
    </thead>
    <tbody>
    @foreach (var r in Model.Filas)
    {
        <tr>
            <td>@r.Empleado</td>
            <td class="text-right">@r.Cantidad</td>
            <td class="text-right">@r.TotalCosto.ToString("C")</td>
            @if (isAdmin)
            {
                <td class="text-right">@r.TotalPrecio.ToString("C")</td>
                <td class="text-right">@r.TotalBeneficio.ToString("C")</td>
            }
        </tr>
    }
    </tbody>
    <tfoot>
    <tr>
        <th>Total</th>
        <th class="text-right">@Model.TotalSelecciones</th>
        <th class="text-right">@Model.TotalCosto.ToString("C")</th>
        @if (isAdmin)
        {
            <th class="text-right">@Model.TotalPrecio.ToString("C")</th>
            <th class="text-right">@Model.TotalBeneficio.ToString("C")</th>
        }
    </tr>
    </tfoot>
</table>
