@model VIP_GATERING.WebUI.Models.Reportes.TotalesEmpleadosVM
@{
    ViewData["Title"] = "Totales por empleado";
    var isAdmin = User.IsInRole("Admin");
}

<h1 class="text-2xl font-semibold mb-4">Totales por empleado (@Model.Inicio:yyyy-MM-dd a @Model.Fin:yyyy-MM-dd)</h1>

<section class="page-panel space-y-4 mb-5">
    <form method="get" class="grid md:grid-cols-4 gap-4 items-end">
        @if (isAdmin)
        {
            <div class="control-field md:col-span-2">
                <label>Empresa</label>
                <select name="empresaId">
                    <option value="">Todas</option>
                    @foreach (var e in Model.Empresas)
                    {
                        <option value="@e.Id" selected="@(Model.EmpresaId == e.Id ? "selected" : null)">@e.Nombre</option>
                    }
                </select>
            </div>
        }
        <div class="control-field md:col-span-2">
            <label>Filial</label>
            <select name="sucursalId">
                <option value="">Todas</option>
                @foreach (var s in Model.Sucursales)
                {
                    <option value="@s.Id" selected="@(Model.SucursalId == s.Id ? "selected" : null)">@s.Nombre</option>
                }
            </select>
        </div>
        <div class="control-field md:col-span-2">
            <label>Empleado</label>
            <select name="empleadoId">
                <option value="">Todos</option>
                @foreach (var e in Model.Empleados)
                {
                    var nombre = !string.IsNullOrWhiteSpace(e.Nombre) ? e.Nombre : e.Codigo;
                    <option value="@e.Id" selected="@(Model.EmpleadoId == e.Id ? "selected" : null)">@nombre</option>
                }
            </select>
        </div>
        <div class="flex gap-3 md:col-span-4">
            <button type="submit" class="btn-primary">Filtrar</button>
            <a class="btn-outline" asp-action="TotalesEmpleados">Limpiar</a>
            <a class="btn-outline" asp-action="TotalesEmpleadosExcel" asp-route-empresaId="@Model.EmpresaId" asp-route-sucursalId="@Model.SucursalId" asp-route-empleadoId="@Model.EmpleadoId">Exportar Excel</a>
            <a class="btn-outline" asp-action="TotalesEmpleadosCsv" asp-route-empresaId="@Model.EmpresaId" asp-route-sucursalId="@Model.SucursalId" asp-route-empleadoId="@Model.EmpleadoId">Exportar CSV</a>
            <a class="btn-outline" asp-action="TotalesEmpleadosPdf" asp-route-empresaId="@Model.EmpresaId" asp-route-sucursalId="@Model.SucursalId" asp-route-empleadoId="@Model.EmpleadoId">Exportar PDF</a>
        </div>
        <div class="md:col-span-4 text-right space-y-1 border-t border-slate-200 pt-3">
            <div class="text-sm text-slate-600">Total costo</div>
            <div class="text-lg font-semibold">@Model.TotalCosto.ToString("C")</div>
            <div class="text-sm text-slate-600">ITBIS</div>
            <div class="text-lg font-semibold">@Model.TotalItbis.ToString("C")</div>
            <div class="text-xs text-slate-500">@Model.TotalSelecciones selecciones</div>
            @if (isAdmin)
            {
                <div class="text-sm text-slate-600 pt-1 border-t border-slate-200">Consumo empleados: <span class="font-semibold">@Model.TotalPrecio.ToString("C")</span></div>
                <div class="text-sm text-slate-600">Beneficio: <span class="font-semibold">@Model.TotalBeneficio.ToString("C")</span></div>
            }
        </div>
        <input type="hidden" name="_" value="@DateTime.UtcNow.Ticks" />
    </form>
</section>

@section Scripts {
    <script src="~/js/reportes-scroll.js" defer></script>
}

<div class="report-scroll">
<table>
    <thead>
    <tr>
        <th>Empleado</th>
        <th class="text-right">Selecciones</th>
        <th class="text-right">Costo empresa</th>
        <th class="text-right">ITBIS</th>
        @if (isAdmin)
        {
            <th class="text-right">Consumo</th>
            <th class="text-right">Beneficio</th>
        }
    </tr>
    </thead>
    <tbody>
    @foreach (var r in Model.Filas)
    {
        <tr>
            <td>@r.Empleado</td>
            <td class="text-right">@r.Cantidad</td>
            <td class="text-right">@r.TotalCosto.ToString("C")</td>
            <td class="text-right">@r.TotalItbis.ToString("C")</td>
            @if (isAdmin)
            {
                <td class="text-right">@r.TotalPrecio.ToString("C")</td>
                <td class="text-right">@r.TotalBeneficio.ToString("C")</td>
            }
        </tr>
    }
    </tbody>
    <tfoot>
    <tr>
        <th>Total</th>
        <th class="text-right">@Model.TotalSelecciones</th>
        <th class="text-right">@Model.TotalCosto.ToString("C")</th>
        <th class="text-right">@Model.TotalItbis.ToString("C")</th>
        @if (isAdmin)
        {
            <th class="text-right">@Model.TotalPrecio.ToString("C")</th>
            <th class="text-right">@Model.TotalBeneficio.ToString("C")</th>
        }
    </tr>
    </tfoot>
</table>
</div>

