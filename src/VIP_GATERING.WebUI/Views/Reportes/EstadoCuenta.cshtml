@model VIP_GATERING.WebUI.Models.Reportes.EstadoCuentaEmpleadoVM
@{
    ViewData["Title"] = "Estado de cuenta";
    var isEmpleado = User.IsInRole("Empleado");
}

<section class="page-panel space-y-4 mb-4">
    <div class="meta-row">
        <span class="meta-pill meta-pill--accent">VIP</span>
        <span class="meta-pill">Empleado: @Model.EmpleadoNombre</span>
        @if (!string.IsNullOrWhiteSpace(Model.EmpleadoCodigo))
        {
            <span class="meta-pill meta-pill--ghost">Codigo empleado: @Model.EmpleadoCodigo</span>
        }
        <span class="meta-pill meta-pill--ghost">Rango: @Model.Desde.ToString("dd/MM") - @Model.Hasta.ToString("dd/MM")</span>
    </div>
    <div class="panel-header">
        <div>
            <p class="eyebrow flex items-center gap-2"><span class="icon-dot" aria-hidden="true"></span> Estado de cuenta</p>
            <p class="panel-title">Movimientos recientes</p>
            <p class="panel-subtitle">Consulta tus consumos por fecha y horario.</p>
        </div>
        <div class="text-right">
            <p class="eyebrow">Total consumo</p>
            <p class="summary-value">@Model.TotalConsumo.ToString("C")</p>
            <div class="summary-hint">Base: @Model.TotalBase.ToString("C")</div>
            <div class="summary-hint">ITBIS: @Model.TotalItbis.ToString("C")</div>
            <p class="summary-hint">@Model.TotalSelecciones selecciones</p>
        </div>
    </div>
</section>

<section class="page-panel space-y-4 mb-5">
    <form method="get" asp-action="EstadoCuenta" class="grid md:grid-cols-3 gap-4 items-end">
        <div class="control-field">
            <label class="flex items-center gap-2" for="desde"><span class="icon-dot icon-dot--teal" aria-hidden="true"></span> Desde</label>
            <input id="desde" name="desde" type="date" class="w-full" value="@Model.Desde.ToString("yyyy-MM-dd")" />
        </div>
        <div class="control-field">
            <label class="flex items-center gap-2" for="hasta"><span class="icon-dot icon-dot--teal" aria-hidden="true"></span> Hasta</label>
            <input id="hasta" name="hasta" type="date" class="w-full" value="@Model.Hasta.ToString("yyyy-MM-dd")" />
        </div>
        <div class="flex flex-wrap items-end justify-between gap-3">
            <div class="flex flex-wrap items-center gap-2">
                <button type="submit" class="btn-primary w-full md:w-auto">Filtrar</button>
                <a asp-action="EstadoCuenta" class="btn-ghost w-full md:w-auto">Ultimos 30 dias</a>
                @if (!isEmpleado)
                {
                    <a asp-action="EstadoCuentaExcel" asp-route-desde="@Model.Desde.ToString("yyyy-MM-dd")" asp-route-hasta="@Model.Hasta.ToString("yyyy-MM-dd")" class="btn-outline w-full md:w-auto">Excel</a>
                    <a asp-action="EstadoCuentaCsv" asp-route-desde="@Model.Desde.ToString("yyyy-MM-dd")" asp-route-hasta="@Model.Hasta.ToString("yyyy-MM-dd")" class="btn-outline w-full md:w-auto">CSV</a>
                    <a asp-action="EstadoCuentaPdf" asp-route-desde="@Model.Desde.ToString("yyyy-MM-dd")" asp-route-hasta="@Model.Hasta.ToString("yyyy-MM-dd")" class="btn-outline w-full md:w-auto">PDF</a>
                }
            </div>
            <div class="text-right">
                <p class="panel-subtitle">Consumo acumulado</p>
                <p class="summary-value">@Model.TotalConsumo.ToString("C")</p>
                <div class="summary-hint">Base: @Model.TotalBase.ToString("C")</div>
                <div class="summary-hint">ITBIS: @Model.TotalItbis.ToString("C")</div>
                <p class="summary-hint">@Model.TotalSelecciones selecciones</p>
            </div>
        </div>
    </form>
</section>

@if (!Model.Movimientos.Any())
{
    <div class="page-panel alert">
        No se encontraron selecciones en el rango indicado.
    </div>
}
<section class="page-panel">
    <div class="overflow-x-auto">
        <div class="report-scroll">
        <table>
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>D&iacute;a</th>
                    <th>Horario</th>
                    <th>Selecci&oacute;n</th>
                    <th class="text-right">Base</th>
                    <th class="text-right">ITBIS</th>
                    <th class="text-right">Total</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var m in Model.Movimientos)
            {
                <tr>
                    <td>@m.Fecha.ToString("yyyy-MM-dd")</td>
                    <td>@m.DiaNombre</td>
                    <td>@m.Horario</td>
                    <td>
                        <div class="font-medium">@m.OpcionNombre</div>
                        <div class="text-xs text-slate-500">Plato @m.Seleccion</div>
                    </td>
                    <td class="text-right">@m.BaseEmpleado.ToString("C")</td>
                    <td class="text-right">@m.ItbisEmpleado.ToString("C")</td>
                    <td class="text-right">@m.TotalEmpleado.ToString("C")</td>
                </tr>
            }
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="4" class="text-right">Total</th>
                    <th class="text-right">@Model.TotalBase.ToString("C")</th>
                    <th class="text-right">@Model.TotalItbis.ToString("C")</th>
                    <th class="text-right">@Model.TotalConsumo.ToString("C")</th>
                </tr>
            </tfoot>
        </table>
        </div>
    </div>
</section>
